:root{--violet:#7b2cff; --violet2:#6a1bff}
html,body{margin:0;height:100%;background:#f2f3f6;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;overflow:hidden;touch-action:none}
canvas{display:block;width:100vw;height:100vh;background:#fff;touch-action:none;user-select:none;-webkit-user-select:none}

/* Верхняя панель со скроллом */
.bar{position:fixed;left:0;right:56px;top:0;z-index:1000;padding:8px 8px 0 8px}
.bar-scroll{display:flex;gap:10px;overflow-x:auto;padding-bottom:8px;-webkit-overflow-scrolling:touch}
.bar-scroll::-webkit-scrollbar{display:none}
.divider{width:1px;background:#e7e3f7;margin:0 2px}

.btn{
  min-width:110px;height:46px;padding:0 16px;border:0;border-radius:14px;
  background:linear-gradient(180deg,var(--violet2),var(--violet));
  color:#fff;font-weight:800;font-size:15px;letter-spacing:.2px;white-space:nowrap;flex:0 0 auto
}
.btn.ghost{background:linear-gradient(180deg,#8c8c8c,#6a6a6a)}
.btn.ok{background:linear-gradient(180deg,#16a34a,#15803d)}
.btn.danger{background:linear-gradient(180deg,#ff4d6d,#e11d48)}
.btn.active{filter:brightness(1.08);box-shadow:0 2px 6px rgba(0,0,0,.18)}

.dropdown{position:relative;flex:0 0 auto}
.menu{
  display:none;position:absolute;top:50px;left:0;
  background:#fff;border:1px solid #e7e3f7;border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);padding:6px;min-width:260px;z-index:1002
}
.menu.open{display:block}
.menu-title{font-size:12px;color:#777;padding:6px 8px 2px}
.menu button{display:block;width:100%;text-align:left;border:0;background:#fff;padding:12px 10px;border-radius:8px;font-size:14px}
.menu button:hover{background:#f6f4ff}

.file-btn{position:relative;display:block;padding:12px;border-radius:10px;background:#fff;cursor:pointer;border:1px dashed #d6d3ee}
.file-btn:hover{background:#f6f4ff}
/* важный хак для iOS: не скрывать input, а сделать его прозрачным поверх */
.file-btn input{position:absolute;inset:0;opacity:0;width:100%;height:100%;cursor:pointer}

.gear{position:fixed;top:8px;right:8px;width:44px;height:44px;border-radius:12px;border:1px solid #e7e3f7;background:#fff;color:#5b30c2;font-weight:800;z-index:1001}

.toast{position:fixed;left:50%;bottom:14px;transform:translateX(-50%);background:#1f1f2e;color:#fff;padding:8px 10px;border-radius:10px;opacity:0;transition:.25s;z-index:1100;pointer-events:none}
.toast.show{opacity:1}

.panel-wrap{position:fixed;inset:0;z-index:1050;display:none}
.panel-wrap.open{display:block}
.panel-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.18)}
.panel{position:absolute;top:70px;right:8px;background:#fff;border:1px solid #e7e3f7;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:12px;width:min(92vw,380px);max-height:80vh;overflow:auto}
.panel h4{margin:6px 0 8px 0;font-size:15px}
.row{display:flex;align-items:center;gap:8px;margin:8px 0}
.row label{min-width:160px;font-size:13px;color:#555}
.row input[type="range"]{flex:1;appearance:none;height:6px;border-radius:999px;background:#eee}
.row input[type="range"]::-webkit-slider-thumb{appearance:none;width:18px;height:18px;border-radius:50%;background:var(--violet)}
.switch{display:flex;align-items:center;gap:8px}
.panel .btn{height:40px}
.val{width:38px;text-align:right;font-size:12px;color:#666}

.angle-tag{position:fixed;pointer-events:none;z-index:1002;background:rgba(27,27,42,.9);color:#fff;font-size:12px;padding:4px 6px;border-radius:8px;transform:translate(-50%,-130%);white-space:nowrap}