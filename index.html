<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>IsoPipe — изометрия по точкам</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <canvas id="cv"></canvas>

  <div class="bar">
    <button id="btnHand" class="btn ghost">Рука</button>
    <button id="btnFit"  class="btn ghost">Фит</button>
    <button id="btnZoomIn" class="btn ghost">＋</button>
    <button id="btnZoomOut" class="btn ghost">－</button>
    <button id="btnLine" class="btn">Линия</button>
    <button id="btnUndo" class="btn ghost">↩ Назад</button>
    <button id="btnExport" class="btn ghost">PNG</button>

    <div class="dropdown">
      <button id="btnLib" class="btn ghost">Элементы ▾</button>
      <div id="libMenu" class="menu">
        <button data-type="ball">Шаровый вентиль</button>
        <button data-type="gate">Задвижка</button>
        <button data-type="globe">Регулирующий</button>
        <button data-type="check">Обратный</button>
        <button data-type="pump">Насос</button>
      </div>
    </div>

    <div class="dropdown">
      <button id="btnMedia" class="btn ghost">Медиа ▾</button>
      <div id="mediaMenu" class="menu">
        <label class="file-btn">
          Сделать фото / выбрать
          <input id="pickImage" type="file" accept="image/*" capture="environment">
        </label>
        <button id="btnClearImage">Убрать фото</button>
      </div>
    </div>
  </div>

  <button id="btnSettings" class="gear" title="Настройки">⚙</button>

  <div id="angleTag" class="angle-tag" style="display:none">0°</div>
  <div id="toast" class="toast"></div>

  <!-- Панель настроек -->
  <div id="panelWrap" class="panel-wrap" aria-hidden="true">
    <div id="panelBackdrop" class="panel-backdrop"></div>
    <div id="panel" class="panel" role="dialog" aria-modal="true" tabindex="-1">
      <h4>Изометрия / Магнит</h4>
      <div class="row switch">
        <input id="snapOn" type="checkbox" checked>
        <label for="snapOn">Притяжение (концы, продление, 0/90/30/150°)</label>
      </div>
      <div class="row">
        <label>Радиус узлов (px)</label>
        <input id="snapRadius" type="range" min="6" max="40" value="18">
        <span id="snapRadiusVal" class="val">18</span>
      </div>
      <div class="row">
        <label>Допуск оси (±°)</label>
        <input id="isoTol" type="range" min="4" max="25" value="10">
        <span id="isoTolVal" class="val">10</span>
      </div>
      <div class="row">
        <label>Липкость концов (px)</label>
        <input id="endStick" type="range" min="12" max="60" value="28">
        <span id="endStickVal" class="val">28</span>
      </div>
      <div class="row">
        <label>Финальная коррекция (px)</label>
        <input id="finalSnapLimit" type="range" min="0" max="20" value="6">
        <span id="finalSnapLimitVal" class="val">6</span>
      </div>

      <h4>Отрисовка</h4>
      <div class="row">
        <label>Толщина линии (px)</label>
        <input id="lineWidth" type="range" min="2" max="24" value="6">
        <span id="lineWidthVal" class="val">6</span>
      </div>
      <div class="row switch">
        <input id="showPoints" type="checkbox" checked>
        <label for="showPoints">Показывать точки</label>
      </div>
      <div class="row">
        <label>Размер точки (px)</label>
        <input id="ptSize" type="range" min="4" max="20" value="10">
        <span id="ptSizeVal" class="val">10</span>
      </div>

      <h4>Шкала элементов</h4>
      <div class="row">
        <label>Пикселей на мм</label>
        <input id="pxPerMm" type="range" min="3" max="16" value="6">
        <span id="pxPerMmVal" class="val">6</span>
      </div>

      <div class="row">
        <button id="btnDone"  class="btn ok">Готово</button>
        <button id="btnClear" class="btn danger">Очистить</button>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
  <script src="valve.js"></script>
</body>
</html>
