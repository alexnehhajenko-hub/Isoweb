<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Pro Trace 3D ‚Äî robust boot</title>
<style>
  html,body{margin:0;height:100%;background:#111;overflow:hidden}
  #status{position:fixed;left:8px;bottom:8px;background:rgba(0,0,0,.75);color:#fff;
          padding:6px 10px;border-radius:8px;font:12px/1.3 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;max-width:92vw}
  canvas{display:block;width:100vw;height:100vh}
</style>
</head>
<body>
  <div id="status">–°—Ç–∞—Ç—É—Å: —Å—Ç–∞—Ä—Ç—É–µ–º‚Ä¶</div>

<script>
(async ()=>{
  const say = (t)=>document.getElementById('status').textContent = t;
  const loadOne = (src)=>new Promise((res,rej)=>{
    const s=document.createElement('script');
    s.src=src; s.async=true; s.crossOrigin="anonymous";
    s.onload=()=>res(src); s.onerror=()=>rej(new Error('fail '+src));
    document.head.appendChild(s);
  });

  async function loadSequential(urls, name){
    let lastErr=null;
    for(const u of urls){
      try{ say(`–ó–∞–≥—Ä—É–∂–∞—é ${name}: ${u}`); await loadOne(u); return u; }
      catch(e){ lastErr=e; }
    }
    throw lastErr||new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${name}`);
  }

  try{
    // THREE
    await loadSequential([
      "https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.min.js",
      "https://unpkg.com/three@0.160.1/build/three.min.js",
      "https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.1/three.min.js"
    ], "three.js");

    // OrbitControls
    await loadSequential([
      "https://cdn.jsdelivr.net/npm/three@0.160.1/examples/js/controls/OrbitControls.js",
      "https://unpkg.com/three@0.160.1/examples/js/controls/OrbitControls.js",
      "https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.1/examples/js/controls/OrbitControls.js"
    ], "OrbitControls");
  }catch(e){
    say("‚ùå –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å. –ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç / –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–∏. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ –∫–æ–Ω—Å–æ–ª–∏.");
    console.error(e);
    return;
  }

  if(!(window.THREE && THREE.OrbitControls)){
    say("‚ùå THREE –∏–ª–∏ OrbitControls –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏.");
    return;
  }

  // ====== SCENE ======
  say("‚úÖ 3D –∑–∞–≥—Ä—É–∂–µ–Ω–æ ‚Äî —Å—Ç—Ä–æ—é —Å—Ü–µ–Ω—É‚Ä¶");
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x141414);

  const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
  camera.position.set(6,5,6);

  const renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setPixelRatio(Math.min(2, window.devicePixelRatio||1));
  renderer.setSize(innerWidth, innerHeight);
  document.body.appendChild(renderer.domElement);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true; controls.dampingFactor = 0.08;

  // grid
  const grid = new THREE.GridHelper(30, 60, 0x333333, 0x242424);
  scene.add(grid);

  // test cube (—á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –≤–∏–¥–µ—Ç—å, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç)
  const cube = new THREE.Mesh(
    new THREE.BoxGeometry(1,1,1),
    new THREE.MeshStandardMaterial({color:0x7c5bff})
  );
  cube.position.set(0,0.5,0);
  scene.add(cube);

  scene.add(new THREE.AmbientLight(0xffffff, 0.6));
  const dir = new THREE.DirectionalLight(0xffffff, 0.9);
  dir.position.set(3,5,2);
  scene.add(dir);

  addEventListener('resize', ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  }, {passive:true});

  (function tick(){
    requestAnimationFrame(tick);
    cube.rotation.y += 0.01;           // —á—É—Ç—å –≤—Ä–∞—â–∞–µ–º –∫—É–± –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
    controls.update();
    renderer.render(scene, camera);
  })();

  say("üü£ –ì–æ—Ç–æ–≤–æ: —Å–µ—Ç–∫–∞ + –∫—É–±. –ö—Ä—É—Ç–∏/–∑—É–º—å –ø–∞–ª—å—Ü–∞–º–∏.");
})();
</script>
</body>
</html>